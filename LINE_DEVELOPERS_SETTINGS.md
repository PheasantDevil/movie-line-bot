# LINE Developers 必須設定

## 🚨 重要：「メッセージありがとうございます」を停止する方法

### 問題
映画検索や映画館検索でキーワードを入力すると、以下の不要なメッセージが自動送信される：

```
メッセージありがとうございます！

申し訳ありませんが、このアカウントでは個別のお問い合わせを受け付けておりません。
次の配信までお待ちください☺️
```

### 原因
LINE Developersコンソールの**「応答メッセージ」**機能がONになっている。

### 解決方法

1. [LINE Developers Console](https://developers.line.biz/console/) にアクセス
2. プロバイダーを選択
3. チャネル（Messaging API）を選択
4. 「Messaging API設定」タブを開く
5. 下にスクロールして「応答設定」セクションを探す

#### 必須設定

```
┌─────────────────────────────────────────────┐
│ 応答設定                                    │
├─────────────────────────────────────────────┤
│ 応答メッセージ                              │
│ ○ ON  ● OFF  ← 必ずOFFにする ✅            │
│                                             │
│ あいさつメッセージ                          │
│ ○ ON  ● OFF  ← OFFにする（推奨）           │
│                                             │
│ Webhook                                     │
│ ● ON  ○ OFF  ← ONにする ✅                 │
└─────────────────────────────────────────────┘
```

6. 「応答メッセージ」を **OFF** に設定
7. 「Webhook」が **ON** になっていることを確認
8. 設定を保存

---

## 📱 Quick Reply表示問題について

### 現象
Quick Replyボタンが「赤枠黒塗りの四角」で表示され、ラベルが見えない。

### 調査結果
- サーバー側のReply APIは正常（ステータスコード: 200、成功）
- LINE APIへの送信データも正しい
- Quick Replyアイテム数: 4
- レスポンスも正常

### 一時的な回避策
トーク画面上部（メッセージ入力欄の上）に以下のテキストアイコンが表示されます：
- 映画検索
- 映画館検索
- 今週公開
- 上映中

**これらのテキストアイコンをタップすることで機能を利用できます。**

### 今後の対応案

#### Option A: Rich Menu（リッチメニュー）の使用
トーク画面下部に常時表示される大きなボタンメニュー。
- メリット: 視認性が高い、常に表示される
- デメリット: 画面の一部を占有する

#### Option B: LINE側の表示バグの報告
LINEのQuick Reply機能にバグがある可能性。
- LINE公式に問い合わせる
- アプリのバージョンを確認・更新

#### Option C: Quick Replyの代替実装
- imageUrlフィールドを使用してアイコン画像を指定
- ただし、画像をホスティングする必要がある

---

## ✅ 現在の設定確認チェックリスト

### LINE Developers Console

- [ ] Webhook URL: `https://movie-line-bot-webhook.onrender.com/webhook`
- [ ] Webhookの利用: **ON**
- [ ] 応答メッセージ: **OFF** ← 重要！
- [ ] あいさつメッセージ: **OFF**（推奨）
- [ ] Webhook検証: 成功

### 動作確認

- [ ] Quick Replyボタンまたはテキストアイコンが表示される
- [ ] 「映画検索」をタップすると「🎬 映画検索モードです」と返信が来る
- [ ] 映画名を入力すると検索結果が表示される
- [ ] **「メッセージありがとうございます」が表示されない** ← 重要！

---

## 📝 補足：Quick Reply表示の技術的詳細

### 送信しているQuick Replyデータ

```json
{
  "type": "action",
  "action": {
    "type": "postback",
    "label": "映画検索",
    "data": "action=movie_search",
    "displayText": "🎬 映画検索"
  }
}
```

### LINE APIからのレスポンス（正常）

```json
{
  "sentMessages": [
    {
      "id": "584075560390230342",
      "quoteToken": "..."
    }
  ]
}
```

### 結論
サーバー側の実装は正しく、LINE APIも正常にメッセージを受信している。
Quick Replyの表示問題はLINEアプリ側の問題と思われる。

