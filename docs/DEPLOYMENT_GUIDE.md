# ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰

æ˜ ç”»æƒ…å ±LINE Botã®Webhookã‚µãƒ¼ãƒãƒ¼ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“‹ ç›®æ¬¡

- [ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã®é¸æŠ](#ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã®é¸æŠ)
- [Render.comã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæ¨å¥¨ï¼‰](#rendercomã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ¨å¥¨)
- [Herokuã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤](#herokuã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤)
- [ãã®ä»–ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ](#ãã®ä»–ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ )
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã®é¸æŠ

| ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  | ç„¡æ–™æ  | ç‰¹å¾´ | æ¨å¥¨åº¦ |
|-----------------|--------|------|--------|
| **Render.com** | âœ… ã‚ã‚Š | ã‚·ãƒ³ãƒ—ãƒ«ã€è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ | â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸ |
| **Heroku** | âŒ ãªã—ï¼ˆè¦ã‚¯ãƒ¬ã‚«ï¼‰ | è±Šå¯Œãªæ©Ÿèƒ½ | â­ï¸â­ï¸â­ï¸ |
| **Railway** | âœ… ã‚ã‚Šï¼ˆåˆ¶é™ã‚ã‚Šï¼‰ | ã‚·ãƒ³ãƒ—ãƒ« | â­ï¸â­ï¸â­ï¸â­ï¸ |
| **Fly.io** | âœ… ã‚ã‚Š | Dockerå¯¾å¿œ | â­ï¸â­ï¸â­ï¸ |

---

## Render.comã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæ¨å¥¨ï¼‰

Render.comã¯ç„¡æ–™æ ãŒã‚ã‚Šã€GitHubã¨é€£æºã—ãŸè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¯èƒ½ã§ã™ã€‚

### å‰ææ¡ä»¶

- GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- Render.comã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆç„¡æ–™ï¼‰
- æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®GitHubãƒªãƒã‚¸ãƒˆãƒª

### ã‚¹ãƒ†ãƒƒãƒ— 1: Render.comã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ

1. [Render.com](https://render.com/)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. **ã€ŒGet Startedã€**ã‚’ã‚¯ãƒªãƒƒã‚¯
3. GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ç™»éŒ²

### ã‚¹ãƒ†ãƒƒãƒ— 2: æ–°ã—ã„Webã‚µãƒ¼ãƒ“ã‚¹ã®ä½œæˆ

1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§**ã€ŒNewã€** > **ã€ŒWeb Serviceã€**ã‚’é¸æŠ
2. GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’æ¥ç¶š
3. ãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠ

### ã‚¹ãƒ†ãƒƒãƒ— 3: ã‚µãƒ¼ãƒ“ã‚¹ã®è¨­å®š

#### åŸºæœ¬è¨­å®š

| é …ç›® | å€¤ |
|------|-----|
| **Name** | `movie-line-bot-webhook` |
| **Region** | `Singapore` ã¾ãŸã¯æœ€å¯„ã‚Šã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ |
| **Branch** | `main` |
| **Root Directory** | ï¼ˆç©ºæ¬„ï¼‰|
| **Runtime** | `Python 3` |

#### ãƒ“ãƒ«ãƒ‰è¨­å®š

| é …ç›® | å€¤ |
|------|-----|
| **Build Command** | `pip install -r requirements.txt` |
| **Start Command** | `gunicorn --bind 0.0.0.0:$PORT src.webhook_server:app` |

#### ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—

- **Instance Type**: `Free` ã‚’é¸æŠ

### ã‚¹ãƒ†ãƒƒãƒ— 4: ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

**Environment Variables** ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ä»¥ä¸‹ã‚’è¿½åŠ ï¼š

```
LINE_CHANNEL_ACCESS_TOKEN=your_channel_access_token_here
LINE_USER_ID=your_user_id_here
LINE_CHANNEL_SECRET=your_channel_secret_here
```

### ã‚¹ãƒ†ãƒƒãƒ— 5: ãƒ‡ãƒ—ãƒ­ã‚¤

1. **ã€ŒCreate Web Serviceã€**ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ‡ãƒ—ãƒ­ã‚¤ãŒé–‹å§‹ã•ã‚Œã¾ã™ï¼ˆ5-10åˆ†ç¨‹åº¦ï¼‰
3. ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª

### ã‚¹ãƒ†ãƒƒãƒ— 6: Webhook URLã®å–å¾—

ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†å¾Œã€URLãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```
https://movie-line-bot-webhook.onrender.com
```

### ã‚¹ãƒ†ãƒƒãƒ— 7: LINE Developersã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã®è¨­å®š

1. [LINE Developers Console](https://developers.line.biz/console/)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒãƒ£ãƒãƒ«ã‚’é¸æŠ
3. **ã€ŒMessaging APIè¨­å®šã€**ã‚¿ãƒ–ã‚’é–‹ã
4. **ã€ŒWebhook URLã€**ã«ä»¥ä¸‹ã‚’å…¥åŠ›ï¼š
   ```
   https://your-app-name.onrender.com/webhook
   ```
5. **ã€Œæ¤œè¨¼ã€**ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æˆåŠŸã‚’ç¢ºèª
6. **ã€ŒWebhookã®åˆ©ç”¨ã€**ã‚’**æœ‰åŠ¹**ã«ã™ã‚‹

### ã‚¹ãƒ†ãƒƒãƒ— 8: å‹•ä½œç¢ºèª

1. LINEã‚¢ãƒ—ãƒªã§Botã®ãƒˆãƒ¼ã‚¯ç”»é¢ã‚’é–‹ã
2. ä½•ã‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
3. Render.comã®ãƒ­ã‚°ã§å—ä¿¡ã‚’ç¢ºèª

```bash
# Render.comãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ > Logs
å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ãƒ†ã‚¹ãƒˆ (ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: U...)
```

### ç„¡æ–™æ ã®åˆ¶é™

Render.comã®ç„¡æ–™æ ï¼š
- âœ… 750æ™‚é–“/æœˆã®ã‚µãƒ¼ãƒ“ã‚¹ç¨¼åƒæ™‚é–“
- âœ… éã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ™‚ã®è‡ªå‹•ã‚¹ãƒªãƒ¼ãƒ—ï¼ˆ15åˆ†å¾Œï¼‰
- âš ï¸ åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆæ•°ç§’ï¼‰

**å¯¾ç­–**: å®šæœŸçš„ãªãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã§èµ·å‹•çŠ¶æ…‹ã‚’ç¶­æŒ

```yaml
# .github/workflows/keep-alive.yml
name: Keep Render.com Alive

on:
  schedule:
    - cron: '*/10 * * * *'  # 10åˆ†ã”ã¨

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - run: curl https://your-app-name.onrender.com/health
```

---

## Herokuã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

Herokuã¯2022å¹´11æœˆã‹ã‚‰ç„¡æ–™ãƒ—ãƒ©ãƒ³ãŒå»ƒæ­¢ã•ã‚Œã¾ã—ãŸãŒã€æœ‰æ–™ãƒ—ãƒ©ãƒ³ã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

### å‰ææ¡ä»¶

- Herokuã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- Heroku CLI
- ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ï¼ˆæœ‰æ–™ãƒ—ãƒ©ãƒ³ï¼‰

### ã‚¹ãƒ†ãƒƒãƒ— 1: Heroku CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# macOS
brew tap heroku/brew && brew install heroku

# Ubuntu
curl https://cli-assets.heroku.com/install.sh | sh

# Windows
# https://devcenter.heroku.com/articles/heroku-cli ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
```

### ã‚¹ãƒ†ãƒƒãƒ— 2: Herokuã«ãƒ­ã‚°ã‚¤ãƒ³

```bash
heroku login
```

### ã‚¹ãƒ†ãƒƒãƒ— 3: Herokuã‚¢ãƒ—ãƒªã®ä½œæˆ

```bash
cd movie-line-bot
heroku create movie-line-bot-webhook
```

### ã‚¹ãƒ†ãƒƒãƒ— 4: ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```bash
heroku config:set LINE_CHANNEL_ACCESS_TOKEN=your_token_here
heroku config:set LINE_USER_ID=your_user_id_here
heroku config:set LINE_CHANNEL_SECRET=your_secret_here
```

### ã‚¹ãƒ†ãƒƒãƒ— 5: ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# Gitãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤
git push heroku main

# ã¾ãŸã¯ç‰¹å®šã®ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
git push heroku your-branch:main
```

### ã‚¹ãƒ†ãƒƒãƒ— 6: ãƒ­ã‚°ã®ç¢ºèª

```bash
heroku logs --tail
```

### ã‚¹ãƒ†ãƒƒãƒ— 7: Webhook URLã®è¨­å®š

```
https://your-app-name.herokuapp.com/webhook
```

### æ–™é‡‘

- **Eco Dyno**: $5/æœˆ
- **Basic Dyno**: $7/æœˆ

---

## ãã®ä»–ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

### Railway

1. [Railway.app](https://railway.app/)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’æ¥ç¶š
3. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
4. è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤

**ç„¡æ–™æ **: $5/æœˆã®ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ

### Fly.io

```bash
# Fly.io CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
curl -L https://fly.io/install.sh | sh

# ãƒ­ã‚°ã‚¤ãƒ³
flyctl auth login

# ã‚¢ãƒ—ãƒªã®ä½œæˆ
flyctl launch

# ãƒ‡ãƒ—ãƒ­ã‚¤
flyctl deploy
```

**ç„¡æ–™æ **: æœˆé–“ä½¿ç”¨é‡ã«å¿œã˜ãŸç„¡æ–™æ ã‚ã‚Š

### Google Cloud Run

Dockerå¯¾å¿œãŒå¿…è¦ã€‚è©³ç´°ã¯åˆ¥é€”ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§ã€‚

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¤±æ•—ã™ã‚‹

#### ã‚¨ãƒ©ãƒ¼: `ModuleNotFoundError`

```bash
# requirements.txtã‚’ç¢ºèª
cat requirements.txt

# ä¾å­˜é–¢ä¿‚ã‚’æ›´æ–°
pip freeze > requirements.txt
git add requirements.txt
git commit -m "Update requirements"
git push
```

#### ã‚¨ãƒ©ãƒ¼: `PORTç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„`

Procfileã‚’ç¢ºèªï¼š

```
web: gunicorn --bind 0.0.0.0:$PORT src.webhook_server:app
```

#### ã‚¨ãƒ©ãƒ¼: `Start command failed`

ãƒ­ã‚°ã‚’ç¢ºèªï¼š

```bash
# Render.com: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ > Logs
# Heroku: heroku logs --tail
```

### WebhookãŒå‹•ä½œã—ãªã„

#### ç—‡çŠ¶: ã€Œæ¤œè¨¼ã€ãƒœã‚¿ãƒ³ã§å¤±æ•—

1. **URLãŒæ­£ã—ã„ã‹ç¢ºèª**
   ```
   https://your-app-name.onrender.com/webhook
   ```

2. **ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª**
   ```bash
   curl https://your-app-name.onrender.com/health
   # å¿œç­”: OK
   ```

3. **ãƒ­ã‚°ã‚’ç¢ºèª**
   ```bash
   # Render.com: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ > Logs
   ```

#### ç—‡çŠ¶: ç½²åæ¤œè¨¼ã‚¨ãƒ©ãƒ¼

```bash
# LINE_CHANNEL_SECRETãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
# Render.com: Environment Variables
# Heroku: heroku config
```

#### ç—‡çŠ¶: 502 Bad Gateway

ã‚µãƒ¼ãƒãƒ¼ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ã¦ã„ã‚‹å¯èƒ½æ€§ï¼š

1. ãƒ­ã‚°ã‚’ç¢ºèª
2. ä¾å­˜é–¢ä¿‚ã‚’ç¢ºèª
3. ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’ç¢ºèª

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡Œ

#### ç—‡çŠ¶: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒé…ã„

**åŸå› 1: ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆ**
- ç„¡æ–™ãƒ—ãƒ©ãƒ³ã§ã¯ã‚¢ã‚¤ãƒ‰ãƒ«æ™‚ã«ã‚¹ãƒªãƒ¼ãƒ—
- åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«èµ·å‹•ã«æ™‚é–“ãŒã‹ã‹ã‚‹

**å¯¾ç­–**:
- Keep-Aliveãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è¿½åŠ 
- æœ‰æ–™ãƒ—ãƒ©ãƒ³ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰

**åŸå› 2: ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãŒé…ã„**
- eiga.comã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«æ™‚é–“ãŒã‹ã‹ã‚‹

**å¯¾ç­–**:
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å®Ÿè£…
- éåŒæœŸå‡¦ç†ã‚’æ¤œè¨

### ãƒ¡ãƒ¢ãƒªä¸è¶³

#### ã‚¨ãƒ©ãƒ¼: `R14 - Memory quota exceeded`

**å¯¾ç­–**:
1. ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’æœ€é©åŒ–
2. ä¸è¦ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‰Šé™¤
3. ãƒ—ãƒ©ãƒ³ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰

```python
# ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’ç¢ºèª
import psutil
process = psutil.Process()
print(f"ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: {process.memory_info().rss / 1024 / 1024:.2f} MB")
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†

- âŒ `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Gitã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„
- âœ… `.gitignore`ã«`.env`ã‚’è¿½åŠ 
- âœ… ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ç’°å¢ƒå¤‰æ•°æ©Ÿèƒ½ã‚’ä½¿ç”¨

### 2. Webhookç½²åã®æ¤œè¨¼

```python
# src/webhook_server.py
if notifier.channel_secret and not notifier.verify_signature(body, signature):
    print("ç½²åæ¤œè¨¼å¤±æ•—")
    abort(400)
```

### 3. HTTPSé€šä¿¡

- âœ… Render.comã€Herokuã¯è‡ªå‹•çš„ã«HTTPSå¯¾å¿œ
- âœ… LINE Webhook URLã‚‚HTTPSãŒå¿…é ˆ

### 4. ãƒ¬ãƒ¼ãƒˆåˆ¶é™

```python
from flask_limiter import Limiter

limiter = Limiter(
    app,
    key_func=lambda: request.headers.get('X-Line-Signature', ''),
    default_limits=["100 per minute"]
)
```

---

## ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### ãƒ­ã‚°ã®ç¢ºèª

#### Render.com
```
ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ > ã‚µãƒ¼ãƒ“ã‚¹ > Logs
```

#### Heroku
```bash
heroku logs --tail
heroku logs --tail --app your-app-name
```

### ã‚¢ãƒƒãƒ—ã‚¿ã‚¤ãƒ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

ç„¡æ–™ã®ã‚¢ãƒƒãƒ—ã‚¿ã‚¤ãƒ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ï¼š

- [UptimeRobot](https://uptimerobot.com/)
- [Pingdom](https://www.pingdom.com/)
- [StatusCake](https://www.statuscake.com/)

è¨­å®š:
- URL: `https://your-app-name.onrender.com/health`
- é–“éš”: 5-10åˆ†

---

## æ›´æ–°å±¥æ­´

- 2025-10-19: åˆç‰ˆä½œæˆ

